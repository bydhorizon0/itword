<th:block th:replace="~{/layout/basic :: setContent(~{this::content})}">
    <th:block th:fragment="content">
        <div class="max-w-5xl mx-auto p-6">

            <h1 class="text-3xl font-bold mb-6" th:text="${movieDetailDTO.title}">ì˜í™” ì œëª©</h1>

            <!-- í‰ì  / ë“±ë¡ì¼ -->
            <div class="flex flex-wrap gap-3 mb-6">
        <span class="inline-flex items-center bg-blue-600 text-white text-base px-3 py-1 rounded-full shadow">
          â­ í‰ì : <span class="ml-1 font-semibold" th:text="${movieDetailDTO.averageRating}">0.0</span>
          (<span class="ml-1" th:text="${movieDetailDTO.ratingCount}">0</span>ëª…)
        </span>
                <span class="inline-flex items-center bg-cyan-300 text-cyan-900 text-base px-3 py-1 rounded-full shadow">
          ğŸ“… ë“±ë¡ì¼: <span class="ml-1"
                       th:text="${#temporals.format(movieDetailDTO.createdAt, 'yyyy-MM-dd HH:mm')}">ë‚ ì§œ</span>
        </span>
            </div>

            <div class="mb-8">
                <p class="text-lg leading-relaxed text-gray-700" th:text="${movieDetailDTO.content}">ì˜í™” ì†Œê°œ</p>
            </div>

            <!-- ì¥ë¥´ -->
            <div class="mb-8">
                <div class="flex flex-wrap gap-3">
          <span class="inline-flex items-center bg-green-600 text-white text-base px-3 py-1 rounded-full shadow">
            ğŸ¬ ì£¼ ì¥ë¥´: <span class="ml-1 font-semibold" th:text="${movieDetailDTO.mainGenre}">ì•¡ì…˜</span>
          </span>
                    <span th:each="genre : ${movieDetailDTO.subGenres}"
                          class="inline-flex items-center bg-gray-400 text-gray-900 text-base px-3 py-1 rounded-full shadow"
                          th:text="'ì„œë¸Œ: ' + ${genre}">ì„œë¸Œ ì¥ë¥´</span>
                </div>
            </div>

            <!-- ì´ë¯¸ì§€ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12"
                 th:if="${!#lists.isEmpty(movieDetailDTO.movieImageDTOList)}">
                <div th:each="img : ${movieDetailDTO.movieImageDTOList}">
                    <img th:src="${img.imageURL}" alt="Movie Image"
                         class="w-full h-auto rounded-lg shadow-md object-cover"/>
                </div>
            </div>

            <hr class="my-8 border-gray-300"/>

            <h4 class="text-xl font-semibold mb-4">ğŸ“ ëŒ“ê¸€</h4>

            <form th:action="@{/replies/save}" method="POST" class="mb-10">
                <input type="hidden" name="movieId" th:value="${movieDetailDTO.id}"/>
                <input type="hidden" name="memberId" th:value="${memberId}"/>

                <div class="bg-white shadow rounded p-6">
                    <h5 class="text-lg font-semibold mb-4">ğŸ’¬ ëŒ“ê¸€ ì‘ì„±</h5>

                    <div class="mb-4">
                        <label for="content" class="block mb-2 font-medium text-gray-700">ë‚´ìš©</label>
                        <textarea id="content" name="content" rows="3" required
                                  placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."
                                  class="w-full border border-gray-300 rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <div class="flex justify-end">
                        <button type="submit"
                                class="inline-flex items-center bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-2 rounded shadow">
                            <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M15.854 1.146a.5.5 0 0 0-.707 0L1 15.293V10a.5.5 0 0 0-1 0v6a.5.5 0 0 0 .5.5H7a.5.5 0 0 0 0-1H1.707l14.147-14.147a.5.5 0 0 0 0-.707z"/>
                            </svg>
                            ë“±ë¡
                        </button>
                    </div>
                </div>
            </form>

            <div>
                <div th:each="reply : ${movieDetailDTO.replyDTOList}" class="mb-6 bg-white p-4 rounded shadow">
                    <div class="flex justify-between items-center mb-2">
                        <strong class="font-semibold text-gray-900"
                                th:text="${reply.memberEmail}">user@example.com</strong>
                        <small class="text-gray-500 text-sm"
                               th:text="${#temporals.format(reply.createdAt, 'yyyy-MM-dd HH:mm')}">ì‹œê°„</small>
                    </div>

                    <p class="mb-3 text-gray-700" th:text="${reply.content}">ëŒ“ê¸€ ë‚´ìš©</p>

                    <div th:if="${reply.parentReplyId != null}" class="text-sm text-gray-500 mb-3">
                        â¤· ë¶€ëª¨ ëŒ“ê¸€ ID: <span th:text="${reply.parentReplyId}"></span>
                    </div>

                    <!-- ëŒ€ëŒ“ê¸€ ë‹¬ê¸° ë²„íŠ¼ (ë¶€ëª¨ ëŒ“ê¸€ì—ë§Œ) -->
                    <div th:if="${reply.parentReplyId == null}">
                        <button type="button"
                                class="reply-toggle-btn text-sm text-blue-600 hover:underline"
                                th:data-reply-id="${reply.id}">
                            ëŒ€ëŒ“ê¸€ ë‹¬ê¸°
                        </button>
                    </div>

                    <!-- ëŒ€ëŒ“ê¸€ ì‘ì„± í¼ (ìˆ¨ê¹€) -->
                    <form th:action="@{/replies/save}" method="POST"
                          class="reply-form mt-3 hidden border border-gray-300 p-4 rounded shadow-sm"
                          th:attr="data-reply-id=${reply.id}">
                        <input type="hidden" name="movieId" th:value="${movieDetailDTO.id}">
                        <input type="hidden" name="memberId" th:value="${memberId}">
                        <input type="hidden" name="parentReplyId" th:value="${reply.id}">

                        <textarea name="content" rows="3" class="w-full p-2 border rounded mb-2"
                                  placeholder="ëŒ€ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>

                        <div class="flex justify-end">
                            <button type="submit"
                                    class="btn btn-primary bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                                ë“±ë¡
                            </button>
                        </div>
                    </form>

                    <!-- ëŒ€ëŒ“ê¸€ ì¶œë ¥ -->
                    <div th:if="${!#lists.isEmpty(reply.childReplies)}" class="ml-6 border-l-2 border-gray-300 pl-4">
                        <div th:each="childReply : ${reply.childReplies}" class="mb-4 p-3 bg-gray-50 rounded shadow-sm">
                            <div class="flex justify-between items-center mb-1">
                                <strong class="font-semibold text-gray-900" th:text="${childReply.memberEmail}">user@example.com</strong>
                                <small class="text-gray-500 text-sm"
                                       th:text="${#temporals.format(childReply.createdAt, 'yyyy-MM-dd HH:mm')}">ì‹œê°„</small>
                            </div>
                            <p class="text-gray-700" th:text="${childReply.content}">ëŒ€ëŒ“ê¸€ ë‚´ìš©</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8">
                <a th:href="@{/movies}"
                   class="inline-block border border-gray-400 rounded px-4 py-2 text-gray-700 hover:bg-gray-200 transition">â†
                    ëª©ë¡ìœ¼ë¡œ</a>
            </div>

        </div>


        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const toggleButtons = document.querySelectorAll('.reply-toggle-btn');

                toggleButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const replyId = button.getAttribute('data-reply-id');

                        const form = document.querySelector(`form.reply-form[data-reply-id='${replyId}']`);

                        if (!form) {
                            return;
                        }

                        if (form.classList.contains('hidden')) {
                            form.classList.remove('hidden');
                            form.style.maxHeight = form.scrollHeight + "px";
                        } else {
                            form.style.maxHeight = null;
                            form.classList.add('hidden');
                        }
                    });
                });
            });

        </script>

    </th:block>
</th:block>

